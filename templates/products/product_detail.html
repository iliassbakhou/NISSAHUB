{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="product-detail-container">
        <!-- Product Image Section -->
        <div class="product-image-section">
             <img src="{{ product.image_url | transform_cloudinary('card') }}" alt="Image for {{ product.name }}">
        </div>

        <!-- Product Info Section -->
        <div class="product-info-section">
            <span class="product-category">{{ product.category }}</span>
            <h1 class="product-name">{{ product.name }}</h1>
            <p class="product-price">Dhs {{ "%.2f"|format(product.price) }}</p>
            <div class="product-description">
                {{ product.description | nl2br | safe }}
            </div>

            <button class="btn btn-primary btn-lg" id="add-to-cart-btn" 
                    data-product-id="{{ product.id }}"
                    data-product-name="{{ product.name }}"
                    data-product-price="{{ product.price }}"
                    data-product-image="{{ product.image_url | transform_cloudinary('card') }}">
                Add to Cart
            </button>

            <!-- Creator Information -->
            {% if author %}
            <div class="creator-card">
                <h3>About The Creator</h3>
                <a href="{{ url_for('creator_profile_page', creator_id=product.author_id) }}" class="creator-info-link">
                    <img src="{{ author.avatar_url or url_for('static', filename='img/avatar_placeholder.png') }}" alt="Avatar for {{ author.displayName }}" class="creator-avatar">
                    <span class="creator-name">{{ author.displayName or 'Anonymous Creator' }}</span>
                </a>
                {% if author.bio %}
                <p class="creator-bio">{{ author.bio }}</p>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}